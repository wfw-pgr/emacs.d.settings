import sys, gmsh
import numpy as np
import generateXYplaneArcCurve as arc

# ========================================================= #
# ===  generate XYplane Arc Box                         === #
# ========================================================= #
def generateXYplaneArcBox( r1=1.0, r2=2.0, zWidth=1.0, zoffset=0.0, lc=0.1, nElems=10 ):
    # ------------------------------------------------- #
    # --- [1] Preparation                           --- #
    # ------------------------------------------------- #
    pts, Lines, Surfaces, Volumes, Parts = {}, {}, {}, {}, {}
    # ------------------------------------------------- #
    # --- [2] generate Arc / End Lines              --- #
    # ------------------------------------------------- #
    arc1  = arc.generateXYplaneArcCurve( radius=r1, zoffset=zoffset, lc=lc )
    arc2  = arc.generateXYplaneArcCurve( radius=r2, zoffset=zoffset, lc=lc )
    Parts["arc1"]   = arc1
    Parts["arc2"]   = arc2
    Lines["arc1_1"] = arc1["Lines"]["line1"]
    Lines["arc1_2"] = arc1["Lines"]["line2"]
    Lines["arc2_1"] = arc2["Lines"]["line1"]
    Lines["arc2_2"] = arc2["Lines"]["line2"]
    Lines["end1"]   = gmsh.model.geo.addLine( ( arc1["pts"] )["-x"][4], ( arc2["pts"] )["-x"][4] )
    Lines["end2"]   = gmsh.model.geo.addLine( ( arc2["pts"] )["+x"][4], ( arc1["pts"] )["+x"][4] )
    # ------------------------------------------------- #
    # --- [3] generate Loop / Surface / Volume      --- #
    # ------------------------------------------------- #
    LineLoop           = [ + Lines["arc1_1"], + Lines["arc1_2"], Lines["end1"], \
                           - Lines["arc2_2"], - Lines["arc2_1"], Lines["end2"]  ]
    LineLoopGroup      = gmsh.model.geo.addCurveLoop( LineLoop )
    Surfaces["Bottom"] = gmsh.model.geo.addPlaneSurface( [ LineLoopGroup ] )
    Volumes ["ArcBox"] = gmsh.model.geo.extrude( [ (2,Surfaces["Bottom"] ) ], \
                                                 0.0, 0.0, zWidth, [nElems] )
    # ------------------------------------------------- #
    # --- [4] PostProcess                           --- #
    # ------------------------------------------------- #
    ret = { "pts":pts, "Lines":Lines, "Surfaces":Surfaces, "Volumes":Volumes, "Parts":Parts }
    return( ret )


# ======================================== #
# ===  実行部                          === #
# ======================================== #
if ( __name__=="__main__" ):

    gmsh.initialize()
    gmsh.option.setNumber( "General.Terminal", 1 )
    gmsh.model.add( "example" )

    generateXYplaneArcBox( r1=1.0, r2=2.0, zWidth=1.0 )
    
    gmsh.model.geo.synchronize()
    gmsh.model.mesh.generate(3)
    gmsh.write( "example.geo_unrolled" )
    gmsh.write( "example.msh" )
    gmsh.finalize()

