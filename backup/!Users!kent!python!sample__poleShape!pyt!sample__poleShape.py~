import os, sys
import numpy as np


# ========================================================= #
# ===  sample__poleShape                                === #
# ========================================================= #
def sample__poleShape():

    # ------------------------------------------------- #
    # --- [1] settings                              --- #
    # ------------------------------------------------- #
    radius = 0.670
    zMin   = 0.200
    zMax   = 0.300
    # ------------------------------------------------- #
    # --- [2] Data Loading                          --- #
    # ------------------------------------------------- #
    mshFile = "dat/mesh.nodes"
    with open( mshFile, "r" ) as f:
        Data = np.loadtxt( f )
    # ------------------------------------------------- #
    # --- [3] shape making                          --- #
    # ------------------------------------------------- #
    xyz      = Data[:,2:]
    radii    = np.sqrt( xyz[:,0]**2 + xyz[:,1]**2 )
    rhat     = 0.5*np.pi * ( radii / radius )
    xyz[:,2] = zMin + ( zMax-zMin )*( np.cos( rhat )**2 )

    # ------------------------------------------------- #
    # --- [4] save output file                      --- #
    # ------------------------------------------------- #
    # -- save dat -- #
    outFile   = "dat/mesh_mod.nodes"
    Data[:,4] = xyz[:,2]
    with open( outFile, "w" ) as f:
        np.savetxt( f, Data )

    # -- draw map -- #
    pngFile  = "png/xyz.png"
    import nkUtilities.cMapTri as cmt
    import nkUtilities.LoadConfig as lcf
    config   = lcf.LoadConfig()
    config["cmp_xAutoRange"] = False
    config["cmp_yAutoRange"] = False
    config["cmp_xRange"]     = [-radius, +radius]
    config["cmp_yRange"]     = [-radius, +radius]
    print( np.min( xyz[:,0] ), np.max( xyz[:,0] ) )
    cmt.cMapTri( xAxis=xyz[:,0], yAxis=xyz[:,1], cMap=xyz[:,2], pngFile=pngFile, config=config )

    
# ======================================== #
# ===  実行部                          === #
# ======================================== #
if ( __name__=="__main__" ):
    sample__poleShape()
