import numpy as np
import sys
import gmsh

import generate__fanShape as fan

# ========================================================= #
# ===  generate outside Air region                      === #
# ========================================================= #
def generate__outAirParts( lc=0.2, radius1=1.0, radius2=2.0, radius3=3.0, \
                           height_tier1=0.0, height_tier2=1.0, \
                           height_tier3=1.2, height_tier4=1.4 ):

    # ------------------------------------------------- #
    # --- [1] settings                              --- #
    # ------------------------------------------------- #
    pts    , line    , surf    , volu     = {}, {}, {}, {}
    origin        = [ 0.0, 0.0 ]
    th1, th2      = -90.0, +90.0
    radius0       = 0.0
    
    # ------------------------------------------------- #
    # --- [2] add Sector Shape                      --- #
    # ------------------------------------------------- #

    delta_12 = height_tier2 - height_tier1
    delta_23 = height_tier3 - height_tier2
    delta_34 = height_tier4 - height_tier3
    
    yoke1      = fan.generate__fanShape( lc=lc, origin=origin, \
                                         r1=radius1, r2=radius3, th1=th1, th2=th2, \
                                         zoffset=height_tier1, height=delta_12, defineVolu=True )
    yoke2      = fan.generate__fanShape( lc=lc, origin=origin, \
                                         r1=radius0, r2=radius3, th1=th1, th2=th2, \
                                         zoffset=height_tier2, height=delta_23, defineVolu=True )
    hat_origin = [ 0.0, 0.0, height_tier3 ]
    hat_vector = [ 0.0, 0.0, height_tier4-height_tier3 ]
    r1, r2     = radius3, radius2
    yoke3      = gmsh.model.occ.addCone( hat_origin[0], hat_origin[1], hat_origin[2], \
                                         hat_vector[0], hat_vector[1], hat_vector[2],
                                         r1, r2, angle=np.pi )
    gmsh.model.occ.rotate( [(3,yoke3)]  , hat_origin[0], hat_origin[1], hat_origin[2], \
                           hat_vector[0], hat_vector[1], hat_vector[2], angle=-0.5*np.pi )

    # --------------------------------------------------------------------- #
    # ret3       = fan.generate__fanShape( lc=lc, origin=origin, \
    #                                      r1=radius0, r2=radius3, th1=th1, th2=th2, \
    #                                      zoffset=height_tier3, height=delta_34, defineVolu=True )
    # yoke3_     = ret3["volu"]["fan"][1][1]
    # yoke3      = gmsh.model.occ.intersect( [(3,yoke3_)], [(3,cone_)] )
    # --------------------------------------------------------------------- #
    
    gmsh.model.occ.removeAllDuplicates()
    
    # ------------------------------------------------- #
    # --- [3] return                                --- #
    # ------------------------------------------------- #
    ret        = { "pts":pts, "line":line, "surf":surf, "volu":volu }
    return( ret )
