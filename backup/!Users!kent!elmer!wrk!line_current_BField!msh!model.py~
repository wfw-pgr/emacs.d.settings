import numpy as np
import os, sys
import gmsh

gmshlib = os.environ["gmshLibraryPath"]
sys.path.append( gmshlib )
import generate__quadShape as qua
import generate__cylinder  as cyl

# ------------------------------------------------- #
# --- [1] initialization of the gmsh            --- #
# ------------------------------------------------- #
gmsh.initialize()
gmsh.option.setNumber( "General.Terminal", 1 )
gmsh.model.add( "model" )

# ------------------------------------------------- #
# --- [2] initialize settings                   --- #
# ------------------------------------------------- #
ptsDim , lineDim , surfDim , voluDim  =  0,  1,  2,  3
pts    , line    , surf    , volu     = {}, {}, {}, {}
ptsPhys, linePhys, surfPhys, voluPhys = {}, {}, {}, {}
lc                                    = 0.2
x_, y_, z_, lc_, tag_                 = 0, 1, 2, 3, 4

# ------------------------------------------------- #
# --- [3] Modeling                              --- #
# ------------------------------------------------- #

zLeng   =   5.0
wire_r  =   0.3
sim__r  =   3.0

xc      = [    0.0,    0.0,   0.0 ]
delta   = [    0.0,    0.0, zLeng ]

lc_sim  = 0.50
lc_wire = 0.05

ret         = cyl.generate__cylinder ( lc=lc_sim, xc=xc, radius=sim__r, \
                                       defineVolu=True, extrude_delta=delta )
volu["sim"] = ret["volu"]["cylinder"]

ret         = cyl.generate__cylinder ( lc=lc_wire, xc=xc, radius=wire_r, \
                                       defineVolu=True, extrude_delta=delta )
volu["cyl"] = ret["volu"]["cylinder"]
gmsh.model.occ.removeAllDuplicates()

volu["cyl"] = 2
volu["sim"] = 3

# ------------------------------------------------- #
# --- [4] Physical Grouping                     --- #
# ------------------------------------------------- #
gmsh.model.occ.synchronize()
voluPhys["sim"] = gmsh.model.addPhysicalGroup( voluDim, [ volu["sim"] ], tag=301 )
voluPhys["cyl"] = gmsh.model.addPhysicalGroup( voluDim, [ volu["cyl"] ], tag=302 )


# ------------------------------------------------- #
# --- [2] post process                          --- #
# ------------------------------------------------- #
gmsh.model.occ.synchronize()
gmsh.model.mesh.generate(3)
gmsh.write( "model.geo_unrolled" )
gmsh.write( "model.msh" )
gmsh.finalize()

