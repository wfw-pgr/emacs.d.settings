import numpy   as np
import os, sys
import gmsh

gmshlib = os.environ["gmshLibraryPath"]
sys.path.append( gmshlib )
import generate__sectorShape as sct

# ========================================================= #
# ===  generate semi-circle Mesh                        === #
# ========================================================= #

def generate__semiCircleMesh( lc=0.1, radius=1.0, origin=[0.0,0.0], \
                              th1=-90.0, th2=+90.0, zoffset=0.0 ):

    # ------------------------------------------------- #
    # --- [1] initialization of the gmsh            --- #
    # ------------------------------------------------- #
    gmsh.initialize()
    gmsh.option.setNumber( "General.Terminal", 1 )
    gmsh.model.add( "model" )

    # ------------------------------------------------- #
    # --- [2] initialize settings                   --- #
    # ------------------------------------------------- #
    ptsDim , lineDim , surfDim , voluDim  =  0,  1,  2,  3
    pts    , line    , surf    , volu     = {}, {}, {}, {}
    ptsPhys, linePhys, surfPhys, voluPhys = {}, {}, {}, {}
    x_, y_, z_, lc_, tag_                 = 0, 1, 2, 3, 4
    
    # ------------------------------------------------- #
    # --- [3] Modeling                              --- #
    # ------------------------------------------------- #
    
    #  -- generate semicircle surface -- #
    ret     = sct.generate__sectorShape( radius=radius, origin=origin, th1=th1, th2=th2, \
                                         zoffset=0.0  , lc=lc, defineSurf=True )
    surf["semicircle"] = ret["surf"]["sector"]
    
    # ------------------------------------------------- #
    # --- [4] Physical Grouping                     --- #
    # ------------------------------------------------- #
    gmsh.model.occ.synchronize()
    surfPhys["semiCircle"] = gmsh.model.addPhysicalGroup( surfDim, [ surf["semicircle"] ], tag=201 )
    
    # ------------------------------------------------- #
    # --- [5] post process                          --- #
    # ------------------------------------------------- #
    gmsh.model.occ.synchronize()
    gmsh.model.mesh.generate(2)
    gmsh.write( "dat/model.geo_unrolled" )
    gmsh.write( "dat/model.msh" )
    gmsh.finalize()



# ======================================== #
# ===  実行部                          === #
# ======================================== #
if ( __name__=="__main__" ):

    radius = 0.670
    generate__semiCircleMesh( radius=radius )
