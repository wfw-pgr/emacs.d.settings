import numpy                   as np


# ========================================================= #
# ===  analyze wine data by Decision Tree               === #
# ========================================================= #

def analyze__DecisionTree():

    # ------------------------------------------------- #
    # --- [1] load data                             --- #
    # ------------------------------------------------- #
    import sklearn.datasets as ds
    wines      = ds.load_wine()
    wineData   = wines.data
    wineRank   = wines.target
    itemNames  = wines.feature_names
    rankNames  = wines.target_names

    import sklearn.model_selection as ms
    test_size     = 0.7
    random_state  = 0
    xTrain, xTest = ms.train_test_split( wineData, test_size=test_size, random_state=random_state )
    yTrain, yTest = ms.train_test_split( wineRank, test_size=test_size, random_state=random_state )
    
    # ------------------------------------------------- #
    # --- [2] Define Dicision Tree                  --- #
    # ------------------------------------------------- #
    import sklearn.tree as skt
    DTC     = skt.DecisionTreeClassifier()
    DTC.fit( xTrain, yTrain )
    score   = DTC.score( xTest, yTest )
    yPred   =  DTC.predict( xTest )
    correct = np.where( ( yPred == yTest ) )
    wrong   = np.where( ( yPred != yTest ) )
    print( "[analyze__DecisionTree.py] score :: {}".format( score ) )
    print( "[analyze__DicisionTree.py] yPred :: {}".format( yPred ) )

    # ------------------------------------------------- #
    # --- [3] scatter plot of comparision           --- #
    # ------------------------------------------------- #
    ax1_, ax2_ = 10, 11
    colorNames = [ "lawngreen", "Cyan", "Orange"]
    import matplotlib.colors as mcl
    cmap       = mcl.ListedColormap( colorNames )
    import matplotlib.pyplot as plt
    fig = plt.figure()
    ax  = fig.add_axes( [0.12,0.12,0.74,0.74] )
    ax.scatter( xTest[:,ax1_]       , xTest[:,ax2_]       , c=yTest   , cmap =cmap   )
    ax.scatter( xTest[:,ax1_][wrong], xTest[:,ax2_][wrong], marker="x", color="black")
    ax.set_xlabel( itemNames[ax1_] )
    ax.set_ylabel( itemNames[ax2_] )
    fig.show()
    plt.show()

    # ------------------------------------------------- #
    # --- [4] export graph tree structure           --- #
    # ------------------------------------------------- #
    import graphviz
    dot_data = skt.export_graphviz( DTC, out_file=None, feature_names=itemNames, \
                                    class_names=rankNames, filled=True, rounded=True)
    graph = graphviz.Source( dot_data )
    graph.render("wine_data", format="png")
    

# ========================================================= #
# ===   Execution of Pragram                            === #
# ========================================================= #

if ( __name__=="__main__" ):
    analyze__DecisionTree()
