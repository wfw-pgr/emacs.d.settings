subroutine linearfilter1d( data, ret, alpha, nFilter, LI )
  implicit none
  integer         , intent(in)  :: LI, nFilter
  double precision, intent(in)  :: data(LI)
  double precision, intent(out) :: ret(LI)
  double precision, intent(in)  :: alpha
  double precision              :: denom
  integer                       :: i, ip1, im1, k
  
  denom = 1.d0 / ( 1.d0 + 2.d0*alpha )
  do k=1, nFilter
     do i=1, LI
        ip1    = min( i+1, LI )
        im1    = max( i-1,  1 )
        ret(i) = denom * ( data(i) + alpha*( data(im1) + data(ip1) ) )
     enddo
  enddo
  
  return
end subroutine linearfilter1d
