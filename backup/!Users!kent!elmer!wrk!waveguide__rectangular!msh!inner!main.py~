import numpy as np
import os, sys
import gmsh_api.gmsh as gmsh

# ------------------------------------------------- #
# --- [1] initialization of the gmsh            --- #
# ------------------------------------------------- #
gmsh.initialize()
gmsh.option.setNumber( "General.Terminal", 1 )
gmsh.model.add( "model" )


# ------------------------------------------------- #
# --- [2] initialize settings                   --- #
# ------------------------------------------------- #
ptsDim , lineDim , surfDim , voluDim  =  0,  1,  2, 3
pts    , line    , surf    , volu     = {}, {}, {}, {}
ptsPhys, linePhys, surfPhys, voluPhys = {}, {}, {}, {}
x_, y_, z_, lc_, tag_                 = 0, 1, 2, 3, 4


# ------------------------------------------------- #
# --- [3] Modeling                              --- #
# ------------------------------------------------- #


import nkGmshRoutines.generate__quadShape as gqs

lc_shell     = 0.02
lc_inner     = 0.02

wg_a         = 0.10
wg_b         = 0.20
wg_L         = 0.60
wg_t         = 0.04
wg_at        = wg_a + wg_t
wg_bt        = wg_b + wg_t

x1_wg_i      = [ -0.5*wg_a ,  -0.5*wg_b , -0.5*wg_L ]
x2_wg_i      = [ +0.5*wg_a ,  -0.5*wg_b , -0.5*wg_L ]
x3_wg_i      = [ +0.5*wg_a ,  +0.5*wg_b , -0.5*wg_L ]
x4_wg_i      = [ -0.5*wg_a ,  +0.5*wg_b , -0.5*wg_L ]

x1_wg_o      = [ -0.5*wg_at,  -0.5*wg_bt, -0.5*wg_L ]
x2_wg_o      = [ +0.5*wg_at,  -0.5*wg_bt, -0.5*wg_L ]
x3_wg_o      = [ +0.5*wg_at,  +0.5*wg_bt, -0.5*wg_L ]
x4_wg_o      = [ -0.5*wg_at,  +0.5*wg_bt, -0.5*wg_L ]

ex_delta     = [       0.0 ,        0.0 ,      wg_L ]

ret1         = gqs.generate__quadShape( lc=lc_inner, defineVolu=True, extrude_delta=ex_delta, \
                                        x1=x1_wg_i , x2=x2_wg_i, \
                                        x3=x3_wg_i , x4=x4_wg_i, recombine=True )
ret2         = gqs.generate__quadShape( lc=lc_inner, defineVolu=True, extrude_delta=ex_delta, \
                                        x1=x1_wg_o , x2=x2_wg_o, \
                                        x3=x3_wg_o , x4=x4_wg_o, recombine=True )

# ------------------------------------------------- #
# --- [4] attribute physical number             --- #
# ------------------------------------------------- #

gmsh.model.occ.removeAllDuplicates()

import nkGmshRoutines.load__physNumTable as pnt
pnt.load__physNumTable( inpFile="physNumTable.dat", line=line, surf=surf )


# ------------------------------------------------- #
# --- [5] post process                          --- #
# ------------------------------------------------- #
gmsh.model.occ.synchronize()
gmsh.model.mesh.generate(3)
gmsh.write( "model.geo_unrolled" )
gmsh.write( "model.msh" )
gmsh.finalize()

