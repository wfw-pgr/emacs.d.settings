program main
  implicit none
  integer


  ! ------------------------------------------------------ !
  ! --- [1] load mshape_svd.dat                        --- !
  ! ------------------------------------------------------ !
  open(lun,file=trim(inpFile),status="old")
  read(lun,*)
  read(lun,*) cmt, nlines, ncmp
  read(lun,*) cmt, LK, LJ, LI, ncmp
  allocate( mshape(ncmp,LI,LJ,LK) )
  do k=1, LK
     do j=1, LJ
        do i=1, LI
           read(lun,*) mshape(:,i,j,k)
        enddo
     enddo
  enddo
  close(lun)

  open(lun,file=trim(inpFile),status="old")
  read(lun,*)
  read(lun,*) cmt, nlines, ncmp
  read(lun,*) cmt, LK, LJ, LI, ncmp
  allocate( aaa(ncmp,LI,LJ,LK) )
  do k=1, LK
     do j=1, LJ
        do i=1, LI
          read(lun,*) aaa(:,i,j,k)
        enddo
     enddo
  enddo
  close(lun)

  ! ------------------------------------------------------ !
  ! --- [2] call extrapolation                         --- !
  ! ------------------------------------------------------ !
  call extrapolate__linear2d( mshape, LI,LJ,LK )

  ! ------------------------------------------------------ !
  ! --- [3] save results                               --- !
  ! ------------------------------------------------------ !
  open(lun,file=trim(outFile),status="replace")
  read(lun,*) "# x_ y_ z_ i_ s_ f_"
  read(lun,*) "# ", nlines, ncmp
  read(lun,*) "# ", LK, LJ, LI, ncmp
  do k=1, LK
     do j=1, LJ
        do i=1, LI
           read(lun,"(6(e15.8,1x))") mshape(:,i,j,k)
        enddo
     enddo
  enddo
  close(lun)
  
contains

  subroutine extrapolate__linear2d( mshape, LI,LJ,LK )
    implicit none
    return
  end subroutine extrapolate__linear2d

end program main
