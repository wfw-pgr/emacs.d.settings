program main
  use variablesMod
  use ioUtilityMod
  use initiatorMod
  use utilitiesMod
  use rkgSolverMod
  implicit none
  integer :: i, j, k
  
  ! ------------------------------------------------------ !
  ! --- [1] preparation of simulation                  --- !
  ! ------------------------------------------------------ !

  call show__programLogo
  
  call load__configFile
  call initialize__variables

  if ( flag__EField ) call load__EFieldFile
  if ( flag__BField ) call load__BFieldFile

  do k=1, LK
     do j=1, LJ
        do i=1, LI
           write(6,"(3(i7,1x),6(e12.5,1x))") i, j, k, EBf(:,i,j,k)
        enddo
     enddo
  enddo
  stop
  call load__particles
  call save__particles( "initi" )

  ! ------------------------------------------------------ !
  ! --- [2] Main Loop                                  --- !
  ! ------------------------------------------------------ !
  do iter=1, iterMax
     !  -- [2-1] display progress bar                  --  !
     ptime = ptime + dt
     call show__progressBar( iter, iterMax )

     !  -- [2-2] step forward particle info.           --  !
     call RK4__tracker
     call popout__boundary
     
     !  -- [2-3] save particle information             --  !
     write(6,*) pxv(1:6,2)
     ! if ( ptime.gt.t_nextSave ) then
     !    call save__particles( "store" )
     ! endif
  enddo

  ! ------------------------------------------------------ !
  ! --- [3] End of Program                             --- !
  ! ------------------------------------------------------ !
  ! call save__particles( "final" )
  ! stop

  deallocate( EBf )
  call show__endLogo  

end program main


